# ユーザーガイド

## セットアップと実行

### 1. 準備

1. `ml/pico-w/` 以下のプログラムを Pico W に転送します。
2. `main.py` (または `config.py`) を開き、以下の設定を環境に合わせて編集します。
   ```python
   WIFI_SSID = "Your_SSID"
   WIFI_PASSWORD = "Your_Password"
   SERVER_URL = "http://your-server.com/api"
   ```

### 2. 実行モード

**通常モード (WiFi制御)**
```bash
python main.py
```
WiFiに接続し、サーバーからのコマンド待機状態になります。

**スタンドアロンモード (ライントレースのみ)**
```bash
python main.py standalone
```
WiFi接続を行わず、起動直後からライントレースを開始します。

## 設定とチューニング

`ml/pico-w/main.py` 内の定数を変更することで、走行特性を調整できます。

### 速度設定
- `BASE_SPEED`: 基本速度 (0-65535)。デフォルト: 30000
- `MAX_SPEED`: 最大速度制限。デフォルト: 54613

### PID制御パラメータ
ライントレースの安定性を調整します。

- **`KP` (比例ゲイン)**: デフォルト 50
  - 値を大きくするとカーブへの反応が良くなりますが、直進でふらつきやすくなります。
- **`KD` (微分ゲイン)**: デフォルト 10
  - 値を大きくすると急激な動きを抑制（ダンピング）しますが、反応が鈍くなることがあります。

## 開発とテスト

### ユニットテスト
`ml/test/unit_test/` 内のスクリプトを使用して、各パーツの動作確認が可能です。
- `motor_test.py`: モーター回転テスト
- `sensor_test.py`: センサー反応テスト
- `wifi_test.py`: ネットワーク接続テスト

### トラブルシューティング

| 現象 | 原因と対策 |
| --- | --- |
| **WiFiに繋がらない** | SSID/Passを確認してください。Pico Wは2.4GHz帯のみ対応です。 |
| **その場で回転してしまう** | 片方のモーター配線が逆の可能性があります。ピン設定を見直してください。 |
| **ラインを無視して直進する** | センサーの高さが不適切か、黒線を認識できていません。`sensor_test.py`で確認してください。 |
| **激しく蛇行する** | `KP`が高すぎるか、`KD`が低すぎます。パラメータを調整してください。 |

## 今後の展望 (Roadmap)

- [ ] **音声コマンドの高度化**: 自然言語処理との連携
- [ ] **Web設定画面**: ブラウザから直接PIDパラメータを調整可能に
- [ ] **コース学習機能**: 走行ログに基づく最適化
