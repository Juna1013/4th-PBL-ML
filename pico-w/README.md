# Pico W ライントレースカー制御プログラム

## 概要
Raspberry Pi Pico W を使用したライントレースカーの制御プログラムです。
WiFi経由でサーバーと通信し、音声認識コマンドに基づいてモーターを制御します。

## ファイル構成

### main.py
メインプログラム。システム全体の制御とループ処理を担当。

### config.py
設定ファイル。WiFi認証情報、サーバーURL、ハードウェアピン設定などを管理。

### wifi_client.py
WiFi通信クライアント。サーバーとの通信（コマンド取得、ステータス送信）を担当。

### motor_control.py
モーター制御クラス。PWM制御による前進、後退、左右旋回の実装。

### audio_capture.py
音声キャプチャクラス。（現在は基本実装のみ）

## セットアップ手順

### 1. 設定ファイルの編集
`config.py` を編集して、使用環境に合わせて設定を変更：

```python
# WiFi設定
WIFI_SSID = "あなたのWiFi名"
WIFI_PASSWORD = "あなたのWiFiパスワード"

# サーバー設定
SERVER_URL = "https://your-api-server.render.com/api"
# または開発時: "http://192.168.1.100:8000/api"
```

### 2. ハードウェア接続
以下のピン配置でモーターを接続：

- 左モーターPWM: GP16
- 右モーターPWM: GP17
- 左モーター方向: GP18
- 右モーター方向: GP19
- 音声入力: GP26

### 3. ライブラリの準備
Pico W に以下のライブラリが必要：
- machine
- network
- urequests
- ujson
- time
- gc

### 4. プログラムの書き込み
1. main.py をはじめとする全ファイルを Pico W に転送
2. Pico W を再起動してプログラム実行

## 動作仕様

### 対応コマンド
- `FORWARD`: 前進
- `BACK`: 後退
- `LEFT`: 左旋回
- `RIGHT`: 右旋回
- `STOP`: 停止

### 通信プロトコル
- コマンド取得: `GET /api/command/latest`
- ステータス送信: `POST /api/pico/status`

### 動作ループ
1. WiFi接続確立
2. サーバーから最新コマンド取得
3. コマンド変更時のみモーター制御実行
4. ステータスをサーバーに送信
5. 設定された間隔（1秒）で待機
6. 2に戻る

## トラブルシューティング

### WiFi接続失敗
- SSID/パスワードの確認
- WiFiルーターの電波強度確認
- config.py の設定内容確認

### サーバー通信エラー
- サーバーURLの確認
- ネットワーク接続状況確認
- ファイアウォール設定確認

### モーター動作不良
- ハードウェア接続確認
- 電源供給確認
- ピン設定確認

## 開発・デバッグ

### シリアル出力の確認
プログラム実行中のログは Thonny や PuTTY などでシリアル接続して確認可能。

### エラーハンドリング
各処理でエラーが発生した場合、自動的に安全停止状態に移行します。

## 今後の拡張予定
- 音声データの直接送信機能
- センサーデータの取得・送信
- より高度な制御アルゴリズム
- ローカルでの簡易制御モード